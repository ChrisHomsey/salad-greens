<!DOCTYPE html>
<html>
<head>
	<title>Test API</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyApq-PEfcIQwjR5iFBj9c0nq_y4DU_k-eE&libraries=places"></script>


	<style type="text/css">
		html, body, #map {
			height: 90%;
			margin: 0px;
			padding: 0px;
		}
	</style>
</head>
<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>



<div id="map">
	
</div>



<input type="text" id="zip-input">
<button id="start-button">Start</button>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
var map;
var infoWindow;
var request;
var service;
var markers = [];
var geocoder;

var happy = {
	food: ['pizza', 'tacos'],
	drinks: ['bar', 'cafe']
}

console.log(happy.food);


geocodeRequest = new google.maps.Geocoder

function initialize() {
	//Geocoder init
	geocoder = new google.maps.Geocoder(); 
	var center = new google.maps.LatLng(41.5043413,-81.6105725);
	map = new google.maps.Map(document.getElementById('map'), {
		center: center,
		zoom: 13

	});


	request = {
		location: center,
		radius: 8047,
		types: ['pizza']
	};

	infoWindow = new google.maps.InfoWindow();

	service = new google.maps.places.PlacesService(map);

	service.nearbySearch(request, callback);

	function queryMap(loc){
		map.setCenter(loc.latLng);
		clearResults(markers);

		var request = {
			location: loc.latLng,
			radius: 8047,
			types: happy.food
		};
		service.nearbySearch(request, callback);
	}

}

function queryZip(loc) {
	var address = '44129';
	geocoder.geocode( { 'address': loc}, function(results, status) {
		if (status == 'OK') {
			map.setCenter(results[0].geometry.location);
			clearResults(markers);
			callback();
			console.log(results);
			
			var newRequest = {
				location: results[0].geometry.location,
				radius: 8047,
				types: ['cafe']
			};
			
			service.nearbySearch(newRequest, callback);

		} else {
			alert('Geocode was not successful for the following reason' + status);
		}
	});
}

function callback(results, status) {
	if(status == google.maps.places.PlacesServiceStatus.OK){
		for (var i = 0; i < results.length; i++){
			createMarker(results[i]);
		}
	}
}

function createMarker(place) {
	var placeLoc = place.geometry.location;
	var marker = new google.maps.Marker({
		map: map,
		position: place.geometry.location
	});

	markers.push(marker);

	google.maps.event.addListener(marker, 'click', function() {
		infoWindow.setContent(place.name);
		infoWindow.open(map, this);
	})
	return marker;
}

function clearResults(markers){
	for (var m in markers) {
		markers[m].setMap(null);
	}
	markers = [];
}

//Interface
$('#start-button').click( function(){
	var zipCode = $('#zip-input').val();
	console.log("Query Zip Code: ", zipCode); 
	queryZip(zipCode);
})

google.maps.event.addDomListener(window, 'load', initialize);

</script>

<script src="./assets/javascript/app.js"></script>
</body>
</html>


